document.addEventListener('DOMContentLoaded', () => {
    // --- Â§öË®ÄË™ûÂØæÂøúÁî®„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Éá„Éº„Çø ---
    const translations = {
        en: {
            // Header
            changeDisplaySize: "Change Display Size",
            display100: "Display: 100%",
            display90: "Display: 90%",
            display85: "Display: 85%",
            display75: "Display: 75%",
            display50: "Display: 50%",
            display30: "Display: 30%",
            shortcuts: "Shortcuts",
            updateHistory: "Update History",
            // Home Screen
            startAsServer: "Start as Server",
            joinAsClient: "Join as Client",
            waitingForClientsTitle: "Waiting for Client Connections",
            waitingForClientsDesc: "Connect from other PCs or tablets using the QR code or URL below.",
            openDirectorWindow: "Open Director Window",
            openPersonalityWindow: "Open Personality Window",
            enterServerIP: "Enter Server PC's IP Address",
            joinAsDirector: "Join as Director",
            joinAsPersonality: "Join as Personality",
            // Director & Personality Screens
            cueSheet: "Cue Sheet",
            prev: "Prev",
            next: "Next",
            saveLog: "Save Log",
            programTimeRemaining: "Program Time Remaining",
            programTimeElapsed: "Program Time Elapsed",
            segmentTimeRemaining: "Segment Time Remaining",
            segmentTimeElapsed: "Segment Time Elapsed",
            timeDifference: "Time Diff.",
            fullscreen: "Fullscreen",
            handwriting: "Handwriting Instructions",
            acknowledged: "OK!",
            clear: "Clear",
            presetMessages: "Preset Messages",
            settings: "Settings",
            endProgram: "End Program",
            instructions: "Instructions",
            waitingForInstructions: "Waiting for instructions...",
            acknowledge: "Acknowledge",
            // Modals
            programSettings: "Program Settings",
            programTitle: "Program Title",
            programDuration: "Total Program Duration (minutes)",
            createCueSheet: "Create Cue Sheet",
            selectTemplate: "Select Template",
            load: "Load",
            save: "Save",
            cornerName: "Segment Name",
            minutes: "Min",
            seconds: "Sec",
            type: "Type",
            addRow: "Add Row",
            startProgramWithSettings: "Start Program with These Settings",
            presetSettings: "Preset Message Settings",
            presetSettingsDesc: "Enter messages separated by commas.",
            saveBtn: "Save",
            cancel: "Cancel",
            shortcutSettings: "Shortcut Key Settings",
            shortcutSettingsDesc: "Click the box for the item you want to set, then press the key or key combination (e.g., Ctrl + S).",
            saveSettings: "Save These Settings",
            // Dynamic Alerts & Text
            alert_connectionLost: "Connection to the server was lost. Returning to home screen.",
            alert_connectionFailed: "Could not connect to the server.",
            alert_enterIP: "Please enter the server PC's IP address.",
            alert_addCueItem: "Please add at least one item to the cue sheet.",
            alert_confirmEndProgram: "Are you sure you want to end the program?",
            alert_noLogToDownload: "There is no log to download.",
            alert_templateSaved: (name) => `Template saved as "${name}".`,
            alert_confirmDeleteTemplate: (name) => `Are you sure you want to delete the template "${name}"?`,
            prompt_enterTemplateName: "Enter a name for the template",
            role_select: "Select Your Role",
            role_enterIP: "Enter Server PC's IP Address",
            serverStarting: "Starting server...",
            copyURL: "Copy URL",
            copied: "Copied!",
            // Cue Sheet Types
            type_talk: "Talk",
            type_music: "Music",
            type_cm: "CM",
            // Shortcut Items
            shortcut_timer: "Timer Start / Stop",
            shortcut_preset: (name) => `Preset: ${name}`,
            // Default Data
            defaultProgramTitle: "My Radio Program",
            defaultCueOpening: "Opening",
            defaultCueMusic1: "Music 1",
            defaultCueCM: "CM",
            defaultCueEnding: "Ending",
            // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£ÁÇπ: „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËã±Ë™û„Å´‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
            defaultPresets: ['üëç', 'OK!', 'Wrap it up!', 'Go to CM', '30s left'],
            // Update History
            updateHistoryContent: [
                { version: "Ver.2.2.1", note: "Minor corrections" },
                { version: "Ver.2.2.0", note: "Added the ability to set multi-key combinations (e.g., Ctrl + S) for shortcuts." },
                { version: "Ver.2.1.3", note: "Fixed a bug where preset messages sent from the director were not displayed on the personality's screen." },
                { version: "Ver.2.1.2", note: "Added a button to copy the server URL. Fixed a bug where text would duplicate when switching languages." },
                { version: "Ver.2.1.1", note: "Fixed a bug that caused text to duplicate when switching languages." },
                { version: "Ver.2.1.0", note: "Added a language switching feature (Japanese/English)." },
                { version: "Ver.2.0.1", note: "Improved the design of the shortcut key settings screen." },
                { version: "Ver.2.0.0", note: "Added a feature to open a Personality window from the server screen, in addition to the Director window." },
                { version: "Ver.1.9.3", note: "Fixed a bug where the display scaling feature was not working." },
                { version: "Ver.1.9.2", note: "Fixed multiple bugs including display scaling, UI for multi-window startup, and handwriting coordinate drift in fullscreen." },
                { version: "Ver.1.9.1", note: "Fixed a bug where the home screen would not appear on launch." },
                { version: "Ver.1.9", note: "Changed to a two-window system to run server and client from one app, resolving port conflicts." },
                { version: "Ver.1.8", note: "Fixed multiple bugs including dark mode, layout issues, button placement, and the Acknowledge button." },
                { version: "Ver.1.7", note: "Fixed an issue where entering fullscreen would be cancelled when changing display scale. Fundamentally resolved layout collapse and coordinate drift on scaling." },
                { version: "Ver.1.6", note: "Fixed a layout bug (right-side margin) and a handwriting coordinate drift issue when changing display scale." },
                { version: "Ver.1.5.1", note: "Fixed an issue where the handwriting area became too small on tablets with small screens." },
                { version: "Ver.1.5", note: "Added a feature to assign shortcut keys to start/stop the timer and for each preset message." },
                { version: "Ver.1.4", note: "Overhauled the PC version layout, resolving display issues on iPad. Fixed a bug causing double lines on the handwriting canvas. Removed PWA features." },
                { version: "Ver.1.3", note: "Enhanced fullscreen functionality via 'Add to Home Screen' to replace PWA installation. Fixed a QR code display bug on server startup." },
                { version: "Ver.1.2.3", note: "Fixed an issue where preset messages would not load on the initial display of the director screen." },
                { version: "Ver.1.2.2", note: "Fixed a bug where a swipe after drawing would erase the canvas." },
                { version: "Ver.1.2.1", note: "Fixed a bug causing time difference miscalculations when using cue sheet next/prev buttons. Improved time calculation accuracy during pause." },
                { version: "Ver.1.2", note: "Enabled role selection (server/client) in the PC/Mac app. Added dark mode. Fixed a time difference calculation bug." },
                { version: "Ver.1.1", note: "Added functionality to use an iPad as a director terminal." },
                { version: "Ver.1.0", note: "First release as an offline version. Implemented all web version features plus easy connection via IP/QR code and two-way communication." },
                { version: "Ver.0.9", note: "Supported 'minutes:seconds' format for cue sheet time input." },
                { version: "Ver.0.8", note: "Added a feature to automatically calculate and display the total program time difference ('push/pull')." },
                { version: "Ver.0.7", note: "Added a feature to specify and color-code cue sheet item types (talk, music, cm, etc.)." },
                { version: "Ver.0.6", note: "Added a feature to save, load, and delete cue sheets as templates." },
                { version: "Ver.0.5", note: "Added an 'Acknowledge' button from the personality for two-way communication." },
                { version: "Ver.0.4", note: "Added a remaining time timer for each segment." },
                { version: "Ver.0.3", note: "Added a feature for users to freely change and save preset messages to the browser." },
                { version: "Ver.0.2", note: "Added timekeeper functionality." },
                { version: "Ver.0.1", note: "Initial release of basic features." }
            ]
        },
        ja: {
            changeDisplaySize: "Ë°®Á§∫„Çµ„Ç§„Ç∫„ÅÆÂ§âÊõ¥", display100: "Ë°®Á§∫: 100%", display90: "Ë°®Á§∫: 90%", display85: "Ë°®Á§∫: 85%", display75: "Ë°®Á§∫: 75%", display50: "Ë°®Á§∫: 50%", display30: "Ë°®Á§∫: 30%", shortcuts: "„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà", updateHistory: "Êõ¥Êñ∞Â±•Ê≠¥", startAsServer: "„Çµ„Éº„Éê„Éº„Å®„Åó„Å¶Ëµ∑Âãï", joinAsClient: "„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å®„Åó„Å¶ÂèÇÂä†", waitingForClientsTitle: "„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆÊé•Á∂ö„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô", waitingForClientsDesc: "‰ªñ„ÅÆPC„ÇÑ„Çø„Éñ„É¨„ÉÉ„Éà„Åã„Çâ„ÄÅ‰ª•‰∏ã„ÅÆQR„Ç≥„Éº„Éâ„Åæ„Åü„ÅØURL„ÅßÊé•Á∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", openDirectorWindow: "„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢„ÇíÈñã„Åè", openPersonalityWindow: "„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÁîªÈù¢„ÇíÈñã„Åè", enterServerIP: "„Çµ„Éº„Éê„ÉºPC„ÅÆIP„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ", joinAsDirector: "„Éá„Ç£„É¨„ÇØ„Çø„Éº„Å®„Åó„Å¶ÂèÇÂä†", joinAsPersonality: "„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£„Å®„Åó„Å¶ÂèÇÂä†", cueSheet: "ÈÄ≤Ë°åË°®", prev: "Ââç„Å∏", next: "Ê¨°„Å∏", saveLog: "„É≠„Ç∞‰øùÂ≠ò", programTimeRemaining: "Áï™ÁµÑÊÆã„ÇäÊôÇÈñì", programTimeElapsed: "Áï™ÁµÑÁµåÈÅéÊôÇÈñì", segmentTimeRemaining: "„Ç≥„Éº„Éä„ÉºÊÆã„ÇäÊôÇÈñì", segmentTimeElapsed: "„Ç≥„Éº„Éä„ÉºÁµåÈÅéÊôÇÈñì", timeDifference: "Êäº„Åó/Â∑ª„Åç", fullscreen: "ÂÖ®ÁîªÈù¢Ë°®Á§∫", handwriting: "ÊâãÊõ∏„ÅçÊåáÁ§∫", acknowledged: "‰∫ÜËß£ÔºÅ", clear: "Ê∂àÂéª", presetMessages: "„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏", settings: "Ë®≠ÂÆö", endProgram: "Áï™ÁµÑÁµÇ‰∫Ü", instructions: "ÊåáÁ§∫", waitingForInstructions: "ÊåáÁ§∫„ÇíÂæÖ„Å£„Å¶„ÅÑ„Åæ„Åô...", acknowledge: "‰∫ÜËß£", programSettings: "Áï™ÁµÑË®≠ÂÆö", programTitle: "Áï™ÁµÑ„Çø„Ç§„Éà„É´", programDuration: "Áï™ÁµÑÂÖ®‰Ωì„ÅÆÊôÇÈñìÔºàÂàÜÔºâ", createCueSheet: "ÈÄ≤Ë°åË°®„ÅÆ‰ΩúÊàê", selectTemplate: "„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû", load: "Ë™≠Ëæº", save: "‰øùÂ≠ò", cornerName: "„Ç≥„Éº„Éä„ÉºÂêç", minutes: "ÂàÜ", seconds: "Áßí", type: "„Çø„Ç§„Éó", addRow: "Ë°å„ÇíËøΩÂä†", startProgramWithSettings: "„Åì„ÅÆÂÜÖÂÆπ„ÅßÁï™ÁµÑ„ÇíÈñãÂßã", presetSettings: "„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ë®≠ÂÆö", presetSettingsDesc: "„Ç´„É≥„ÉûÂå∫Âàá„Çä„Åß„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", saveBtn: "‰øùÂ≠ò„Åô„Çã", cancel: "„Ç≠„É£„É≥„Çª„É´", shortcutSettings: "„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„ÉºË®≠ÂÆö",
            shortcutSettingsDesc: "Ë®≠ÂÆö„Åó„Åü„ÅÑÈ†ÖÁõÆ„ÅÆ„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åã„Çâ„ÄÅÂâ≤„ÇäÂΩì„Å¶„Åü„ÅÑ„Ç≠„Éº„Åæ„Åü„ÅØ„Ç≠„Éº„ÅÆÁµÑ„ÅøÂêà„Çè„ÅõÔºà‰æã: Ctrl + SÔºâ„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
            saveSettings: "„Åì„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò", alert_connectionLost: "„Çµ„Éº„Éê„Éº„Å®„ÅÆÊé•Á∂ö„ÅåÂàá„Çå„Åæ„Åó„Åü„ÄÇ„Éõ„Éº„É†ÁîªÈù¢„Å´Êàª„Çä„Åæ„Åô„ÄÇ", alert_connectionFailed: "„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ", alert_enterIP: "„Çµ„Éº„Éê„ÉºPC„ÅÆIP„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", alert_addCueItem: "ÈÄ≤Ë°åË°®„Å´È†ÖÁõÆ„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", alert_confirmEndProgram: "Êú¨ÂΩì„Å´Áï™ÁµÑ„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü", alert_noLogToDownload: "„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åô„Çã„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ", alert_templateSaved: (name) => `„Äå${name}„Äç„Å®„ÅÑ„ÅÜÂêçÂâç„Åß„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü„ÄÇ`, alert_confirmDeleteTemplate: (name) => `„ÉÜ„É≥„Éó„É¨„Éº„Éà„Äå${name}„Äç„ÇíÊú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`, prompt_enterTemplateName: "„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ", role_select: "ÂΩπÂâ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ", role_enterIP: "„Çµ„Éº„Éê„ÉºPC„ÅÆIP„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ", serverStarting: "„Çµ„Éº„Éê„Éº„ÇíËµ∑Âãï‰∏≠...", copyURL: "URL„Çí„Ç≥„Éî„Éº", copied: "„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ", type_talk: "„Éà„Éº„ÇØ", type_music: "Ê•ΩÊõ≤", type_cm: "CM", shortcut_timer: "„Çø„Ç§„Éû„ÉºÈñãÂßã / ÂÅúÊ≠¢", shortcut_preset: (name) => `„Éó„É™„Çª„ÉÉ„Éà: ${name}`,
            defaultProgramTitle: "„Éû„Ç§„É©„Ç∏„Ç™„Éó„É≠„Ç∞„É©„É†",
            defaultCueOpening: "„Ç™„Éº„Éó„Éã„É≥„Ç∞",
            defaultCueMusic1: "Ê•ΩÊõ≤1",
            defaultCueCM: "CM",
            defaultCueEnding: "„Ç®„É≥„Éá„Ç£„É≥„Ç∞",
            defaultPresets: ['üëç', 'OK!', 'Â∑ª„ÅÑ„Å¶ÔºÅ', 'CM„Å∏', '„ÅÇ„Å®30Áßí'],
            updateHistoryContent: [
                { version: "Ver.2.2.1", note: "ËªΩÂ∫¶„Å™‰øÆÊ≠£" },
                { version: "Ver.2.2.0", note: "„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº„Å´Ctrl„ÇÑShift„Å™„Å©„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„ÅüË§áÊï∞„Ç≠„Éº„ÇíË®≠ÂÆö„Åß„Åç„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.2.1.3", note: "„Éá„Ç£„É¨„ÇØ„Çø„Éº„Åã„ÇâÈÄÅ‰ø°„Åï„Çå„Åü„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£„Å´Ë°®Á§∫„Åï„Çå„Å™„ÅÑ‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.2.1.2", note: "„Çµ„Éº„Éê„ÉºURL„Çí„Ç≥„Éî„Éº„Åô„Çã„Éú„Çø„É≥„ÇíËøΩÂä†„ÄÇË®ÄË™ûÂàáÊõøÊôÇ„Å´„ÉÜ„Ç≠„Çπ„Éà„Åå‰∫åÈáçË°®Á§∫„Åï„Çå„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.2.1.1", note: "Ë®ÄË™û„ÇíÂàá„ÇäÊõø„Åà„ÇãÈöõ„Å´„ÉÜ„Ç≠„Çπ„Éà„Åå‰∫åÈáç„Å´Ë°®Á§∫„Åï„Çå„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.2.1.0", note: "Ë®ÄË™ûÂàáÊõøÊ©üËÉΩÔºàÊó•Êú¨Ë™û/Ëã±Ë™ûÔºâ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.2.0.1", note: "„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„ÉºË®≠ÂÆöÁîªÈù¢„ÅÆ„Éá„Ç∂„Ç§„É≥„ÇíÊîπÂñÑ„ÄÇ" },
                { version: "Ver.2.0.0", note: "„Çµ„Éº„Éê„ÉºÁîªÈù¢„Åã„Çâ„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢„Å†„Åë„Åß„Å™„Åè„ÄÅ„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÁîªÈù¢„ÇÇÂà•„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅßÈñã„Åë„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.1.9.3", note: "Êã°Â§ßÁ∏ÆÂ∞èÊ©üËÉΩ„ÅåÂãï‰Ωú„Åó„Å™„ÅÑ‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.9.2", note: "Êã°Â§ßÁ∏ÆÂ∞èÊ©üËÉΩ„ÄÅË§áÊï∞„Ç¶„Ç£„É≥„Éâ„Ç¶Ëµ∑ÂãïÊôÇ„ÅÆUI„ÄÅÂÖ®ÁîªÈù¢Ë°®Á§∫ÊôÇ„ÅÆÊâãÊõ∏„ÅçÂ∫ßÊ®ô„Åö„Çå„Å™„Å©„ÄÅË§áÊï∞„ÅÆ‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.9.1", note: "Ëµ∑ÂãïÊôÇ„Å´„Éõ„Éº„É†ÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Å™„ÅÑ‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.9", note: "„Çµ„Éº„Éê„Éº„Å®„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Çí1„Å§„ÅÆ„Ç¢„Éó„É™„Åã„Çâ2„Å§„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅßËµ∑Âãï„Åô„ÇãÊñπÂºè„Å´Â§âÊõ¥„ÄÇË§áÊï∞Ëµ∑ÂãïÊôÇ„ÅÆ„Éù„Éº„ÉàÁ´∂Âêà„Ç®„É©„Éº„ÇíËß£Ê∂à„Åó„ÄÅÂêå‰∏ÄPC„Åß„ÅÆÂà©Áî®„ÇíÁ∞°Á¥†Âåñ„ÄÇ" },
                { version: "Ver.1.8", note: "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„ÄÅÈÄ≤Ë°åË°®Ë®≠ÂÆöÁîªÈù¢„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„ÄÅ„Éú„Çø„É≥ÈÖçÁΩÆ„ÄÅiPad„Åß„ÅÆÂÖ®ÁîªÈù¢Á∂≠ÊåÅ„ÄÅ‰∫ÜËß£„Éú„Çø„É≥„ÅÆÂãï‰Ωú„Å®Ë°®Á§∫„Å™„Å©„ÄÅË§áÊï∞„ÅÆ‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.7", note: "Ë°®Á§∫„Çπ„Ç±„Éº„É´Â§âÊõ¥ÊôÇ„Å´ÂÖ®ÁîªÈù¢„ÅåËß£Èô§„Åï„Çå„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ„Åæ„Åü„ÄÅ„Çπ„Ç±„Éº„É´Â§âÊõ¥ÊôÇ„ÅÆ„É¨„Ç§„Ç¢„Ç¶„ÉàÂ¥©„Çå„Å®ÊâãÊõ∏„ÅçÂ∫ßÊ®ô„ÅÆ„Åö„Çå„ÇíÊ†πÊú¨ÁöÑ„Å´Ëß£Ê±∫„ÄÇ" },
                { version: "Ver.1.6", note: "Ë°®Á§∫„Çπ„Ç±„Éº„É´Â§âÊõ¥ÊôÇ„Å´Áô∫Áîü„Åô„Çã„É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆÂ¥©„ÇåÔºàÂè≥ÂÅ¥„ÅÆ‰ΩôÁôΩÔºâ„Å®„ÄÅÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ„ÅÆÂ∫ßÊ®ô„Åå„Åö„Çå„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.5.1", note: "ÁîªÈù¢„ÅåÂ∞è„Åï„ÅÑ„Çø„Éñ„É¨„ÉÉ„Éà„Åß„ÇÇÊâãÊõ∏„ÅçÂÖ•Âäõ„ÅåÂ∞è„Åï„Åè„Å™„ÇãÂïèÈ°å„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.5", note: "„Çø„Ç§„Éû„Éº„ÅÆÈñãÂßã/ÂÅúÊ≠¢„ÄÅÂêÑ„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Å´„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº„ÇíÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.1.4", note: "PCÁâà„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÂ§ßÂπÖ„Å´Âà∑Êñ∞„ÄÇiPad„Åß„ÅÆË°®Á§∫Â¥©„Çå„ÇíÂÖ®Èù¢ÁöÑ„Å´Ëß£Ê∂à„Åó„ÄÅ„Çπ„ÇØ„É≠„Éº„É´„Åõ„Åö„Å´ÂÖ®Ë¶ÅÁ¥†„ÅåË°®Á§∫„Åï„Çå„Çã„Çà„ÅÜ„Å´ÊîπÂñÑ„ÄÇÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ„ÅßÁ∑ö„Åå‰∫åÈáç„Å´„Å™„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇPWAÊ©üËÉΩ„ÇíÂªÉÊ≠¢„ÄÇ" },
                { version: "Ver.1.3", note: "PWA„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´Ê©üËÉΩ„Å´‰ª£„Çè„Çä„ÄÅ„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„Å´„Çà„ÇãÂÖ®ÁîªÈù¢Ë°®Á§∫Ê©üËÉΩ„ÇíÂº∑Âåñ„ÄÇ„Çµ„Éº„Éê„ÉºËµ∑ÂãïÊôÇ„ÅÆQR„Ç≥„Éº„ÉâË°®Á§∫„Å´Èñ¢„Åô„Çã‰∏çÂÖ∑Âêà„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.2.3", note: "„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢„ÅÆÂàùÂõûË°®Á§∫ÊôÇ„Å´„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Å™„ÅÑÂïèÈ°å„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.2.2", note: "ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ„Åß„ÄÅÊõ∏„ÅçÁµÇ„Åà„ÅüÂæå„Å´„Çπ„ÉØ„Ç§„Éó„Åô„Çã„Å®ÊèèÁîª„ÅåÊ∂à„Åà„ÇãÂïèÈ°å„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.2.1", note: "ÈÄ≤Ë°åË°®„ÅÆÊ¨°„Å∏/Ââç„Å∏„Éú„Çø„É≥Êìç‰ΩúÊôÇ„Å´Êäº„ÅóÂ∑ª„ÅçÊôÇÈñì„Åå„Åö„Çå„Çã„Éê„Ç∞„Çí‰øÆÊ≠£„ÄÇ‰∏ÄÊôÇÂÅúÊ≠¢ÊôÇ„ÅÆÊôÇÈñìË®àÁÆóÁ≤æÂ∫¶„ÇíÂêë‰∏ä„ÄÇ" },
                { version: "Ver.1.2", note: "PC/Mac„Ç¢„Éó„É™„Åß„Çµ„Éº„Éê„Éº/„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆÂΩπÂâ≤„ÇíÈÅ∏ÊäûÂèØËÉΩ„Å´„ÄÇ„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„ÇíËøΩÂä†„ÄÇÊäº„ÅóÂ∑ª„ÅçÊôÇÈñì„ÅÆË®àÁÆó„Éê„Ç∞„Çí‰øÆÊ≠£„ÄÇ" },
                { version: "Ver.1.1", note: "iPad„Çí„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁ´ØÊú´„Å®„Åó„Å¶‰ΩøÁî®„Åô„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.1.0", note: "„Ç™„Éï„É©„Ç§„É≥Áâà„Å®„Åó„Å¶ÂàùÂõû„É™„É™„Éº„Çπ„ÄÇ„Ç¶„Çß„ÉñÁâà„ÅÆÂÖ®Ê©üËÉΩ„Å´Âä†„Åà„ÄÅIP„Ç¢„Éâ„É¨„Çπ„ÉªQR„Ç≥„Éº„Éâ„Å´„Çà„ÇãÁ∞°ÂçòÊé•Á∂ö„ÄÅÂèåÊñπÂêëÈÄö‰ø°„Å™„Å©„ÇíÂÆüË£Ö„ÄÇ" },
                { version: "Ver.0.9", note: "ÈÄ≤Ë°åË°®„ÅÆÊôÇÈñìÂÖ•Âäõ„Çí„ÄåÂàÜ:Áßí„ÄçÂΩ¢Âºè„Å´ÂØæÂøú„ÄÇ" },
                { version: "Ver.0.8", note: "Áï™ÁµÑÂÖ®‰Ωì„ÅÆÊôÇÈñì„ÅÆ„ÄåÊäº„Åó/Â∑ª„Åç„Äç„ÇíËá™ÂãïË®àÁÆó„Åó„Å¶Ë°®Á§∫„Åô„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.7", note: "ÈÄ≤Ë°åË°®„Å´„Çø„Ç§„ÉóÔºàtalk, music, cm„Å™„Å©Ôºâ„ÇíÊåáÂÆö„Åó„ÄÅËâ≤ÂàÜ„ÅëË°®Á§∫„Åô„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.6", note: "ÈÄ≤Ë°åË°®„Çí„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å®„Åó„Å¶‰øùÂ≠ò„ÉªË™≠Ëæº„ÉªÂâäÈô§„Åß„Åç„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.5", note: "„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£„Åã„Çâ„ÅÆ„Äé‰∫ÜËß£„Äè„Éú„Çø„É≥„ÇíËøΩÂä†„Åó„ÄÅÂèåÊñπÂêë„ÅÆ„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥„ÇíÂèØËÉΩ„Å´„ÄÇ" },
                { version: "Ver.0.4", note: "„Ç≥„Éº„Éä„Éº„Åî„Å®„ÅÆÊÆã„ÇäÊôÇÈñì„Çø„Ç§„Éû„ÉºÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.3", note: "„Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Çí„É¶„Éº„Ç∂„Éº„ÅåËá™Áî±„Å´Â§âÊõ¥„Åó„ÄÅ„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åß„Åç„ÇãÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.2", note: "„Çø„Ç§„É†„Ç≠„Éº„Éë„ÉºÊ©üËÉΩ„ÇíËøΩÂä†„ÄÇ" },
                { version: "Ver.0.1", note: "Âü∫Êú¨Ê©üËÉΩ„Çí„É™„É™„Éº„Çπ„ÄÇ" }
            ]
        }
    };

    let currentLang = localStorage.getItem('timeqLang') || 'ja';

    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åã„Çâ‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('timeqLang', lang);
        document.documentElement.lang = lang;
        const t = translations[lang];
        document.querySelectorAll('[data-i18n-key]').forEach(el => {
            const key = el.dataset.i18nKey;
            if (t[key]) {
                el.innerHTML = t[key];
            }
        });
        document.querySelectorAll('[data-i18n-placeholder-key]').forEach(el => {
            const key = el.dataset.i18nPlaceholderKey;
            if (t[key]) {
                el.placeholder = t[key];
            }
        });
        document.querySelectorAll('[data-i18n-title-key]').forEach(el => {
            const key = el.dataset.i18nTitleKey;
            if (t[key]) {
                el.title = t[key];
            }
        });
        document.getElementById('language-select').value = lang;

        // Ë®ÄË™û„Å´ÈÄ£Âãï„Åô„ÇãÂãïÁöÑ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂÜçË™≠„ÅøËæº„Åø
        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„ÇÄ();
        // „Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇÇÂÜçÊèèÁîª„Åô„Çã
        if (!„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢.classList.contains('hidden')) {
            „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÊèèÁîª„Åô„Çã();
        }
    }
    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ

    const ÂÖ®„Å¶„ÅÆÁîªÈù¢ = document.querySelectorAll('main > div, .modal');
    const „Éõ„Éº„É†ÁîªÈù¢ = document.getElementById('home-screen');
    const „Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢ = document.getElementById('director-screen');
    const „Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÁîªÈù¢ = document.getElementById('personality-screen');
    const Áï™ÁµÑË®≠ÂÆö„É¢„Éº„ÉÄ„É´ = document.getElementById('program-settings-modal');
    const Êõ¥Êñ∞Â±•Ê≠¥„É¢„Éº„ÉÄ„É´ = document.getElementById('history-log-modal');
    const „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´ = document.getElementById('preset-settings-modal');
    const „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´ = document.getElementById('shortcut-settings-modal');
    const „Éõ„Éº„É†„Çø„Ç§„Éà„É´ = document.getElementById('home-title');
    const electron„Éõ„Éº„É† = document.getElementById('electron-home');
    const browser„Éõ„Éº„É† = document.getElementById('browser-home');
    const „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥ = document.getElementById('start-server-btn');
    const „ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å®„Åó„Å¶ÂèÇÂä†„Éú„Çø„É≥ = document.getElementById('join-as-client-btn');
    const directorÂèÇÂä†„Éú„Çø„É≥ = document.getElementById('join-director-btn');
    const personalityÂèÇÂä†„Éú„Çø„É≥ = document.getElementById('join-personality-btn');
    const IPÂÖ•ÂäõÊ¨Ñ = document.getElementById('ip-input');
    const „Çµ„Éº„Éê„ÉºÊÉÖÂ†± = document.getElementById('server-info');
    const „Çµ„Éº„Éê„ÉºQR„Ç≥„Éº„ÉâÁîªÂÉè = document.getElementById('server-qr-code-image');
    const „Çµ„Éº„Éê„ÉºURL„ÉÜ„Ç≠„Çπ„Éà = document.getElementById('server-url-text');
    const openDirectorWindowBtn = document.getElementById('open-director-window-btn');
    const openPersonalityWindowBtn = document.getElementById('open-personality-window-btn');
    const copyUrlBtn = document.getElementById('copy-url-btn');
    const Èñâ„Åò„Çã„Éú„Çø„É≥Áæ§ = document.querySelectorAll('.close-btn');
    const Êõ¥Êñ∞Â±•Ê≠¥„Éú„Çø„É≥ = document.getElementById('history-log-btn');
    const Êõ¥Êñ∞Â±•Ê≠¥„É™„Çπ„Éà = document.getElementById('history-log-list');
    const „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„Éú„Çø„É≥ = document.getElementById('shortcut-settings-btn');
    const „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„É™„Çπ„Éà„Ç≥„É≥„ÉÜ„Éä = document.getElementById('shortcut-list-container');
    const „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà‰øùÂ≠ò„Éú„Çø„É≥ = document.getElementById('save-shortcuts-btn');
    const Ë°®Á§∫„Çµ„Ç§„Ç∫ÈÅ∏Êäû = document.getElementById('display-scale-select');
    const Ë®ÄË™ûÈÅ∏Êäû = document.getElementById('language-select');
    const „Éá„Ç£„É¨„ÇØ„Çø„ÉºÈÄ≤Ë°åË°® = document.getElementById('director-cue-sheet');
    const Ââç„Å∏„Éú„Çø„É≥ = document.getElementById('prev-item-btn');
    const Ê¨°„Å∏„Éú„Çø„É≥ = document.getElementById('next-item-btn');
    const „Çø„Ç§„Éû„ÉºË°®Á§∫„Ç®„É™„Ç¢ = document.getElementById('timer-display');
    const Áï™ÁµÑ„Çø„Ç§„Éû„ÉºË°®Á§∫ = document.getElementById('program-timer');
    const „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„ÉºË°®Á§∫ = document.getElementById('segment-timer');
    const Áï™ÁµÑ„Çø„Ç§„Éû„Éº„É©„Éô„É´ = document.getElementById('program-timer-label');
    const „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„Éº„É©„Éô„É´ = document.getElementById('segment-timer-label');
    const ÊôÇÈñìÂ∑ÆË°®Á§∫ = document.getElementById('time-diff');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ = document.getElementById('handwriting-canvas');
    const „Ç≠„É£„É≥„Éê„ÇπÊ∂àÂéª„Éú„Çø„É≥ = document.getElementById('clear-canvas-btn');
    const Áï™ÁµÑÁµÇ‰∫Ü„Éú„Çø„É≥ = document.getElementById('end-program-btn');
    const „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„Ç®„É™„Ç¢ = document.getElementById('preset-buttons-area');
    const „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„Éú„Çø„É≥ = document.getElementById('open-preset-settings-btn');
    const ‰∫ÜËß£„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº = document.getElementById('ack-indicator');
    const „É≠„Ç∞„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥ = document.getElementById('download-log-btn');
    const „Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÈÄ≤Ë°åË°® = document.getElementById('personality-cue-sheet');
    const „Çø„Ç§„Éû„ÉºË°®Á§∫„Ç®„É™„Ç¢_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('timer-display-personality');
    const Áï™ÁµÑ„Çø„Ç§„Éû„ÉºË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('program-timer-personality');
    const „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„ÉºË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('segment-timer-personality');
    const Áï™ÁµÑ„Çø„Ç§„Éû„Éº„É©„Éô„É´_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('program-timer-label-personality');
    const „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„Éº„É©„Éô„É´_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('segment-timer-label-personality');
    const ÊôÇÈñìÂ∑ÆË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ = document.getElementById('time-diff-personality');
    const ÊåáÁ§∫Ë°®Á§∫„Ç®„É™„Ç¢ = document.getElementById('instruction-display-area');
    const „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫ = document.getElementById('preset-message-display');
    const ‰∫ÜËß£„Éú„Çø„É≥ = document.getElementById('ack-btn');
    const Áï™ÁµÑ„Çø„Ç§„Éà„É´ÂÖ•ÂäõÊ¨Ñ = document.getElementById('program-title');
    const Áï™ÁµÑÊôÇÈñìÂÖ•ÂäõÊ¨Ñ = document.getElementById('program-duration');
    const Áï™ÁµÑÈñãÂßã„Éú„Çø„É≥ = document.getElementById('start-program-btn');
    const „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•ÂäõÊ¨Ñ = document.getElementById('preset-messages-input');
    const „Éó„É™„Çª„ÉÉ„Éà‰øùÂ≠ò„Éú„Çø„É≥ = document.getElementById('save-preset-messages-btn');
    const ÈÄ≤Ë°åË°®Ë°å„Ç≥„É≥„ÉÜ„Éä = document.getElementById('cue-sheet-rows-container');
    const Ë°åËøΩÂä†„Éú„Çø„É≥ = document.getElementById('add-cue-row-btn');
    const „ÉÜ„É≥„Éó„É¨„Éº„Éà‰øùÂ≠ò„Éú„Çø„É≥ = document.getElementById('save-template-btn');
    const „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû = document.getElementById('template-select');
    const „ÉÜ„É≥„Éó„É¨„Éº„ÉàË™≠Ëæº„Éú„Çø„É≥ = document.getElementById('load-template-btn');
    const „ÉÜ„É≥„Éó„É¨„Éº„ÉàÂâäÈô§„Éú„Çø„É≥ = document.getElementById('delete-template-btn');
    const „Ç´„Çπ„Çø„É†„Éó„É≠„É≥„Éó„Éà„É¢„Éº„ÉÄ„É´ = document.getElementById('custom-prompt-modal');
    const „Éó„É≠„É≥„Éó„Éà„Çø„Ç§„Éà„É´ = document.getElementById('prompt-title');
    const „Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ = document.getElementById('prompt-input');
    const „Éó„É≠„É≥„Éó„ÉàOK„Éú„Çø„É≥ = document.getElementById('prompt-ok-btn');
    const „Éó„É≠„É≥„Éó„Éà„Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥ = document.getElementById('prompt-cancel-btn');
    const „ÉÜ„Éº„ÉûÂàáÊõø„Éú„Çø„É≥ = document.getElementById('theme-toggle-btn');
    const „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥ = document.querySelector('#theme-toggle-btn i');
    const ÂÖ®ÁîªÈù¢Ë°®Á§∫„Éú„Çø„É≥ = document.getElementById('fullscreen-btn');

    let socket;
    let Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ = null;
    let animationFrameId = null;
    let timerMode = 'countdown';
    let ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ;
    let „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà = [];
    let programLog = [];
    let currentProgramState = null;
    let shortcuts = {};
    const isElectron = !!window.electronAPI;
    let lastCanvasWidth = 1;
    let lastCanvasHeight = 1;
    let resizeTimer;

    function ÂàùÊúüÂåñÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ() {
        if (!ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ) return;
        if (ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ) {
            ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.off();
        }
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.width = ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.offsetWidth * ratio;
        ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.height = ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.offsetHeight * ratio;
        ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.getContext("2d").scale(ratio, ratio);
        ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ = new SignaturePad(ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ);
        lastCanvasWidth = ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.offsetWidth;
        lastCanvasHeight = ÊâãÊõ∏„Åç„Ç≠„É£„É≥„Éê„Çπ.offsetHeight;
        ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.addEventListener("afterUpdateStroke", ÊâãÊõ∏„ÅçÊõ¥Êñ∞Âá¶ÁêÜ);
    }

    function handleCanvasResize() {
        if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ !== 'director' || !ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ) return;
        const data = ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.toData();
        const oldWidth = lastCanvasWidth;
        const oldHeight = lastCanvasHeight;
        ÂàùÊúüÂåñÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ();
        const newWidth = lastCanvasWidth;
        const newHeight = lastCanvasHeight;
        if (data.length > 0 && oldWidth > 0 && oldHeight > 0) {
            const scaleX = newWidth / oldWidth;
            const scaleY = newHeight / oldHeight;
            if (scaleX === 1 && scaleY === 1) return;
            const scaledData = data.map(group => ({
                ...group,
                points: group.points.map(point => ({ ...point, x: point.x * scaleX, y: point.y * scaleY }))
            }));
            ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.fromData(scaledData);
        }
    }

    function applyDisplayScale(scale) {
        const baseFontSize = 16;
        document.documentElement.style.fontSize = `${baseFontSize * scale}px`;
    }

    function loadDisplayScale() {
        const savedScale = localStorage.getItem('timeqDisplayScale') || 1;
        Ë°®Á§∫„Çµ„Ç§„Ç∫ÈÅ∏Êäû.value = savedScale;
        applyDisplayScale(savedScale);
    }

    const ÊâãÊõ∏„ÅçÊõ¥Êñ∞Âá¶ÁêÜ = throttle(() => {
        if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director' && ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ) {
            const „Éá„Éº„ÇøURL = ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.isEmpty() ? '' : ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.toDataURL();
            sendData('handwritingUpdate', { dataURL: „Éá„Éº„ÇøURL });
        }
    }, 100);

    function ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(Ë°®Á§∫„Åô„ÇãÁîªÈù¢) {
        ÂÖ®„Å¶„ÅÆÁîªÈù¢.forEach(ÁîªÈù¢ => ÁîªÈù¢.classList.add('hidden'));
        if (Ë°®Á§∫„Åô„ÇãÁîªÈù¢) Ë°®Á§∫„Åô„ÇãÁîªÈù¢.classList.remove('hidden');
    }

    function connectToServer(ipAddress) {
        const t = translations[currentLang];
        socket = new WebSocket('ws://' + ipAddress + ':8080');
        socket.onopen = () => {
            console.log('„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åó„Åæ„Åó„Åü„ÄÇ');
            if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') {
                sendData('identify', { role: 'director' });
                Áï™ÁµÑË®≠ÂÆö„É¢„Éº„ÉÄ„É´„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã();
                Áï™ÁµÑË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.remove('hidden');
            } else {
                ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÁîªÈù¢);
            }
        };
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            handleServerMessage(data);
        };
        socket.onclose = () => {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            alert(t.alert_connectionLost);
            window.location.reload();
        };
        socket.onerror = (error) => {
            console.error('WebSocket„Ç®„É©„Éº:', error);
            alert(t.alert_connectionFailed);
        };
    }

    function handleServerMessage(data) {
        const t = translations[currentLang];
        if (data.type === 'stateUpdate') {
            const prevState = currentProgramState;
            currentProgramState = data.payload;
            const state = currentProgramState;
            if (!state) return;
            if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') {
                ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢);
                if (state.programStatus === 'running') {
                    playPauseBtn.innerHTML = `<i class="fas fa-pause"></i> PAUSE`;
                    playPauseBtn.classList.add('paused');
                } else {
                    playPauseBtn.innerHTML = `<i class="fas fa-play"></i> START`;
                    playPauseBtn.classList.remove('paused');
                }
            } else {
                ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÁîªÈù¢);
            }
            if (prevState && state.currentItemIndex !== prevState.currentItemIndex) {
                const newCue = state.cueSheet[state.currentItemIndex];
                let totalElapsedMs = state.totalElapsedTime;
                if (state.programStatus === 'running') {
                    totalElapsedMs += Date.now() - state.lastStartTime;
                }
                programLog.push(`${formatLogTime(totalElapsedMs)} - Segment Start: ${newCue.title}`);
            }
            ÈÄ≤Ë°åË°®„ÇíÊèèÁîª„Åô„Çã(state.cueSheet, state.currentItemIndex);
            Êäº„ÅóÂ∑ª„ÅçÊôÇÈñì„ÇíÊèèÁîª„Åô„Çã(state.timeDifference);
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            if (state.programStatus === 'running') {
                const loop = () => {
                    updateAllTimers(state);
                    animationFrameId = requestAnimationFrame(loop);
                };
                animationFrameId = requestAnimationFrame(loop);
            } else {
                updateAllTimers(state);
            }
        }
        if (data.type === 'handwritingUpdate') {
            if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'personality') {
                const { dataURL } = data.payload;
                if (dataURL) {
                    ÊåáÁ§∫Ë°®Á§∫„Ç®„É™„Ç¢.innerHTML = `<img src="${dataURL}" alt="Handwritten instruction">`;
                } else {
                    ÊåáÁ§∫Ë°®Á§∫„Ç®„É™„Ç¢.innerHTML = `<p>${t.waitingForInstructions}</p>`;
                }
            }
        }
        if (data.type === 'presetMessage') {
            if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'personality') {
                const { text } = data.payload;
                „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫.textContent = text;
                „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫.classList.remove('hidden');
                setTimeout(() => „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫.classList.add('hidden'), 5000);
            }
        }
        if (data.type === 'acknowledged') {
            if (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') {
                ‰∫ÜËß£„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº.classList.add('show');
                setTimeout(() => {
                    ‰∫ÜËß£„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº.classList.remove('show');
                }, 2000);
            }
        }
        if (data.type === 'programEnded') {
            alert(t.alert_confirmEndProgram);
            window.location.reload();
        }
    }

    function sendData(type, payload) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type, payload }));
        }
    }

    function ÂèÇÂä†„Åô„Çã(role) {
        const t = translations[currentLang];
        Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ = role;
        const ipAddress = IPÂÖ•ÂäõÊ¨Ñ.value.trim();
        if (!ipAddress) {
            alert(t.alert_enterIP);
            return;
        }
        connectToServer(ipAddress);
    }

    function throttle(func, limit) {
        let inThrottle;
        return function () {
            const args = arguments;
            const context = this;
            if (!inThrottle) {
                func.apply(context, args);
                inThrottle = true;
                setTimeout(() => inThrottle = false, limit);
            }
        }
    }

    function ÈÄ≤Ë°åË°®„ÇíÊèèÁîª„Åô„Çã(ÈÄ≤Ë°åË°®„Éá„Éº„Çø, ÁèæÂú®„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ) {
        if (!ÈÄ≤Ë°åË°®„Éá„Éº„Çø) return;
        const ÊèèÁîªÂÖà = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? „Éá„Ç£„É¨„ÇØ„Çø„ÉºÈÄ≤Ë°åË°® : „Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£ÈÄ≤Ë°åË°®;
        ÊèèÁîªÂÖà.innerHTML = '';
        ÈÄ≤Ë°åË°®„Éá„Éº„Çø.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `cue-item type-${item.type || 'talk'}`;
            if (index === ÁèæÂú®„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ) div.classList.add('current');
            div.innerHTML = `<span class="cue-title">${item.title}</span><span class="cue-duration">${formatTime(item.duration).substring(1)}</span>`;
            ÊèèÁîªÂÖà.appendChild(div);
        });
        const ÁèæÂú®„ÅÆÈ†ÖÁõÆ = ÊèèÁîªÂÖà.querySelector('.current');
        if (ÁèæÂú®„ÅÆÈ†ÖÁõÆ) ÁèæÂú®„ÅÆÈ†ÖÁõÆ.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function updateAllTimers(state) {
        const t = translations[currentLang];
        let totalElapsedSeconds = state.totalElapsedTime / 1000;
        if (state.programStatus === 'running') {
            totalElapsedSeconds += (Date.now() - state.lastStartTime) / 1000;
        }
        const currentCueItem = state.cueSheet[state.currentItemIndex];
        let segmentElapsedSeconds = 0;
        if (state.currentItemStartTime > 0) {
            const runningTime = Date.now() - state.currentItemStartTime;
            segmentElapsedSeconds = (state.programStatus === 'running') ? runningTime / 1000 : (state.lastPauseTime - state.currentItemStartTime) / 1000;
        }
        const segmentRemainingSeconds = currentCueItem.duration - segmentElapsedSeconds;
        const programClock = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? Áï™ÁµÑ„Çø„Ç§„Éû„ÉºË°®Á§∫ : Áï™ÁµÑ„Çø„Ç§„Éû„ÉºË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£;
        const programLabel = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? Áï™ÁµÑ„Çø„Ç§„Éû„Éº„É©„Éô„É´ : Áï™ÁµÑ„Çø„Ç§„Éû„Éº„É©„Éô„É´_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£;
        const segmentClock = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„ÉºË°®Á§∫ : „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„ÉºË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£;
        const segmentLabel = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„Éº„É©„Éô„É´ : „Çª„Ç∞„É°„É≥„Éà„Çø„Ç§„Éû„Éº„É©„Éô„É´_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£;
        programLabel.textContent = (timerMode === 'countup') ? t.programTimeElapsed : t.programTimeRemaining;
        const programDisplaySeconds = (timerMode === 'countup') ? totalElapsedSeconds : state.totalDuration - totalElapsedSeconds;
        programClock.textContent = formatTime(programDisplaySeconds, true).substring(1);
        segmentLabel.textContent = (timerMode === 'countup') ? t.segmentTimeElapsed : t.segmentTimeRemaining;
        const segmentDisplaySeconds = (timerMode === 'countup') ? segmentElapsedSeconds : segmentRemainingSeconds;
        segmentClock.textContent = formatTime(segmentDisplaySeconds).substring(1);
        segmentClock.style.color = segmentRemainingSeconds < 0 ? '#e74c3c' : '#1abc9c';
    }

    function Êäº„ÅóÂ∑ª„ÅçÊôÇÈñì„ÇíÊèèÁîª„Åô„Çã(timeDifference) {
        const targetElement = (Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') ? ÊôÇÈñìÂ∑ÆË°®Á§∫ : ÊôÇÈñìÂ∑ÆË°®Á§∫_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£;
        targetElement.textContent = formatTime(timeDifference);
        targetElement.classList.remove('over', 'under');
        if (timeDifference > 5) {
            targetElement.classList.add('over');
        } else if (timeDifference < -5) {
            targetElement.classList.add('under');
        }
    }

    function formatTime(totalSeconds, showHours = false) {
        if (isNaN(totalSeconds)) totalSeconds = 0;
        const sign = totalSeconds < 0 ? "-" : "+";
        const absSeconds = Math.abs(totalSeconds);
        const hours = Math.floor(absSeconds / 3600);
        const minutes = Math.floor((absSeconds % 3600) / 60);
        const seconds = Math.floor(absSeconds % 60);
        if (showHours) {
            return [hours, minutes, seconds].map(v => v.toString().padStart(2, '0')).join(':');
        }
        return sign + [minutes, seconds].map(v => v.toString().padStart(2, '0')).join(':');
    }

    function formatLogTime(totalMilliseconds) {
        if (isNaN(totalMilliseconds)) totalMilliseconds = 0;
        const totalSeconds = Math.floor(totalMilliseconds / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = Math.floor(totalSeconds % 60);
        return [hours, minutes, seconds].map(v => v.toString().padStart(2, '0')).join(':');
    }

    function Áï™ÁµÑ„ÇíÈñãÂßã„Åô„Çã() {
        const t = translations[currentLang];
        const ÈÄ≤Ë°åË°®„Éá„Éº„Çø = [];
        document.querySelectorAll('#cue-sheet-rows-container .cue-sheet-row').forEach((row, index) => {
            ÈÄ≤Ë°åË°®„Éá„Éº„Çø.push({
                id: index,
                title: row.querySelector('.cue-title-input').value || 'Untitled',
                duration: (parseInt(row.querySelector('.cue-minutes-input').value, 10) || 0) * 60 + (parseInt(row.querySelector('.cue-seconds-input').value, 10) || 0),
                type: row.querySelector('.cue-type-select').value
            });
        });
        if (ÈÄ≤Ë°åË°®„Éá„Éº„Çø.length === 0) {
            alert(t.alert_addCueItem);
            return;
        }

        const Áï™ÁµÑ„Éá„Éº„Çø = {
            title: Áï™ÁµÑ„Çø„Ç§„Éà„É´ÂÖ•ÂäõÊ¨Ñ.value,
            totalDuration: parseInt(Áï™ÁµÑÊôÇÈñìÂÖ•ÂäõÊ¨Ñ.value, 10) * 60,
            cueSheet: ÈÄ≤Ë°åË°®„Éá„Éº„Çø,
        };
        programLog = [`[00:00:00] - Program Start: ${Áï™ÁµÑ„Éá„Éº„Çø.title}`];
        sendData('startProgram', Áï™ÁµÑ„Éá„Éº„Çø);
        Áï™ÁµÑË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.add('hidden');
        if (!isElectron || Ëá™ÂàÜ„ÅÆÂΩπÂâ≤ === 'director') {
            ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(„Éá„Ç£„É¨„ÇØ„Çø„ÉºÁîªÈù¢);
            „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÊèèÁîª„Åô„Çã();
            setTimeout(ÂàùÊúüÂåñÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ, 100);
        }
    }

    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åã„Çâ‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
    function „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„ÇÄ() {
        // ÁèæÂú®„ÅÆË®ÄË™ûË®≠ÂÆö„Å´Âøú„Åò„Åü„Ç≠„Éº„ÅßlocalStorage„Åã„ÇâË™≠„ÅøËæº„ÇÄ
        const ‰øùÂ≠ò„Åï„Çå„Åü„É°„ÉÉ„Çª„Éº„Ç∏ = localStorage.getItem(`timeqPresetMessages_${currentLang}`);
        if (‰øùÂ≠ò„Åï„Çå„Åü„É°„ÉÉ„Çª„Éº„Ç∏) {
            „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà = ‰øùÂ≠ò„Åï„Çå„Åü„É°„ÉÉ„Çª„Éº„Ç∏.split(',');
        } else {
            // ‰øùÂ≠ò„Åï„Çå„Åü„ÇÇ„ÅÆ„Åå„Å™„Åë„Çå„Å∞„ÄÅÁèæÂú®„ÅÆË®ÄË™û„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®
            „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà = translations[currentLang].defaultPresets;
        }
    }
    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ

    function „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÊèèÁîª„Åô„Çã() {
        „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„Ç®„É™„Ç¢.innerHTML = '';
        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà.forEach(msg => {
            const button = document.createElement('button');
            button.className = 'preset-btn';
            button.dataset.message = msg;
            button.textContent = msg;
            „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„Ç®„É™„Ç¢.appendChild(button);
        });
    }

    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åã„Çâ‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ
    function „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Çí‰øùÂ≠ò„Åô„Çã() {
        const messages = „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•ÂäõÊ¨Ñ.value.split(',').map(m => m.trim()).filter(m => m);
        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà = messages;
        // ÁèæÂú®„ÅÆË®ÄË™ûË®≠ÂÆö„Å´Âøú„Åò„Åü„Ç≠„Éº„ÅßlocalStorage„Å´‰øùÂ≠ò„Åô„Çã
        localStorage.setItem(`timeqPresetMessages_${currentLang}`, messages.join(','));
        „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÇíÊèèÁîª„Åô„Çã();
        „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.add('hidden');
    }
    // ‚òÖ‚òÖ‚òÖ „Åì„Åì„Åæ„Åß‰øÆÊ≠£ ‚òÖ‚òÖ‚òÖ

    function addCueRow(title = '', minutes = '', seconds = '', type = 'talk') {
        const t = translations[currentLang];
        const row = document.createElement('div');
        row.className = 'cue-sheet-row';
        row.innerHTML = `<div class="col-title"><input type="text" class="cue-title-input" placeholder="${t.cornerName}" value="${title}"></div><div class="col-min"><input type="number" class="cue-minutes-input" placeholder="${t.minutes}" value="${minutes}" min="0"></div><div class="col-sec"><input type="number" class="cue-seconds-input" placeholder="${t.seconds}" value="${seconds}" min="0" max="59"></div><div class="col-type"><select class="cue-type-select"><option value="talk" ${type === 'talk' ? 'selected' : ''}>${t.type_talk}</option><option value="music" ${type === 'music' ? 'selected' : ''}>${t.type_music}</option><option value="cm" ${type === 'cm' ? 'selected' : ''}>${t.type_cm}</option></select></div><div class="col-action"><button class="remove-cue-row-btn icon-btn danger-btn">√ó</button></div>`;
        ÈÄ≤Ë°åË°®Ë°å„Ç≥„É≥„ÉÜ„Éä.appendChild(row);
        row.querySelector('.remove-cue-row-btn').addEventListener('click', () => row.remove());
    }

    function Áï™ÁµÑË®≠ÂÆö„É¢„Éº„ÉÄ„É´„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã() {
        const t = translations[currentLang];
        Áï™ÁµÑ„Çø„Ç§„Éà„É´ÂÖ•ÂäõÊ¨Ñ.value = t.defaultProgramTitle;
        Áï™ÁµÑÊôÇÈñìÂÖ•ÂäõÊ¨Ñ.value = '30';
        ÈÄ≤Ë°åË°®Ë°å„Ç≥„É≥„ÉÜ„Éä.innerHTML = '';
        addCueRow(t.defaultCueOpening, '5', '0', 'talk');
        addCueRow(t.defaultCueMusic1, '4', '0', 'music');
        addCueRow(t.defaultCueCM, '1', '0', 'cm');
        addCueRow(t.defaultCueEnding, '1', '0', 'talk');
    }

    // „Ç≠„Éº„Ç§„Éô„É≥„Éà„Åã„Çâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÊñáÂ≠óÂàó„ÇíÁîüÊàê„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
    function eventToShortcutString(e) {
        const code = e.code;
        // ‰øÆÈ£æ„Ç≠„ÉºÔºàCtrl, Shift„Å™„Å©ÔºâÂçò‰Ωì„Åß„ÅÆÊäº‰∏ã„ÅØÁÑ°Ë¶ñ„Åô„Çã
        if (['ControlLeft', 'ControlRight', 'ShiftLeft', 'ShiftRight', 'AltLeft', 'AltRight', 'MetaLeft', 'MetaRight'].includes(code)) {
            return null;
        }

        const parts = [];
        if (e.ctrlKey) parts.push('Ctrl');
        if (e.metaKey) parts.push('Meta'); // Mac„ÅÆCmd„Ç≠„Éº„ÄÅWindows„ÅÆWin„Ç≠„Éº
        if (e.altKey) parts.push('Alt');
        if (e.shiftKey) parts.push('Shift');

        parts.push(code);

        return parts.join('+');
    }

    // ‰øùÂ≠ò„Åï„Çå„Åü„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÊñáÂ≠óÂàó„ÇíÁîªÈù¢Ë°®Á§∫Áî®„Å´„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åô„ÇãÈñ¢Êï∞
    function formatShortcutString(shortcutString) {
        if (!shortcutString) return translations[currentLang].settings || 'Not Set';

        const parts = shortcutString.split('+');
        const formattedParts = parts.map(part => {
            let formatted = part;
            // KeyA -> A, Digit1 -> 1 „ÅÆ„Çà„ÅÜ„Å´Êï¥ÂΩ¢
            if (part.startsWith('Key')) {
                formatted = part.substring(3);
            } else if (part.startsWith('Digit')) {
                formatted = part.substring(5);
            } else if (part === 'Meta') {
                formatted = '‚åò / Win'; // Mac / Windows „Åß„ÅÆË°®Á§∫„ÇíËÄÉÊÖÆ
            }
            return formatted;
        });

        return formattedParts.join(' + ');
    }

    function loadShortcuts() {
        shortcuts = JSON.parse(localStorage.getItem('timeqShortcuts') || '{}');
    }

    function saveShortcuts() {
        const newShortcuts = {};
        document.querySelectorAll('.shortcut-row').forEach(row => {
            const action = row.dataset.action;
            const keyInput = row.querySelector('.shortcut-key-input');
            const key = keyInput.dataset.key;
            if (action && key) {
                newShortcuts[action] = key;
            }
        });
        shortcuts = newShortcuts;
        localStorage.setItem('timeqShortcuts', JSON.stringify(shortcuts));
        alert(translations[currentLang].saveSettings);
        „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.add('hidden');
    }

    function openShortcutSettingsModal() {
        const t = translations[currentLang];
        „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„É™„Çπ„Éà„Ç≥„É≥„ÉÜ„Éä.innerHTML = '';
        createShortcutRow('togglePlayPause', t.shortcut_timer);
        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà.forEach((msg, index) => {
            createShortcutRow(`preset_${index}`, t.shortcut_preset(msg));
        });
        „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.remove('hidden');
    }

    function createShortcutRow(action, label) {
        const row = document.createElement('div');
        row.className = 'shortcut-row';
        row.dataset.action = action;
        const labelEl = document.createElement('div');
        labelEl.className = 'shortcut-label';
        labelEl.textContent = label;
        const keyInputEl = document.createElement('div');
        keyInputEl.className = 'shortcut-key-input';
        keyInputEl.textContent = formatShortcutString(shortcuts[action]);
        keyInputEl.dataset.key = shortcuts[action] || '';
        keyInputEl.addEventListener('click', () => listenForKey(keyInputEl));
        row.appendChild(labelEl);
        row.appendChild(keyInputEl);
        „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„É™„Çπ„Éà„Ç≥„É≥„ÉÜ„Éä.appendChild(row);
    }

    function listenForKey(targetElement) {
        document.querySelectorAll('.shortcut-key-input.recording').forEach(el => {
            el.classList.remove('recording');
            el.textContent = formatShortcutString(el.dataset.key);
        });
        targetElement.classList.add('recording');
        targetElement.textContent = '...';

        const keydownHandler = (e) => {
            e.preventDefault();
            e.stopPropagation();

            const shortcutString = eventToShortcutString(e);

            // ‰øÆÈ£æ„Ç≠„ÉºÂçò‰Ωì„Åß„Å™„ÅÑ„ÄÅÊúâÂäπ„Å™ÁµÑ„ÅøÂêà„Çè„Åõ„ÅÆÂ†¥Âêà„ÅÆ„ÅøË®≠ÂÆö
            if (shortcutString) {
                targetElement.textContent = formatShortcutString(shortcutString);
                targetElement.dataset.key = shortcutString;
                targetElement.classList.remove('recording');
                window.removeEventListener('keydown', keydownHandler, { capture: true });
            }
        };
        window.addEventListener('keydown', keydownHandler, { capture: true });
    }

    function handleGlobalKeyDown(e) {
        const isTyping = ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);
        const isModalOpen = !!document.querySelector('.modal:not(.hidden)');
        if (isTyping || isModalOpen) return;

        const currentShortcut = eventToShortcutString(e);
        if (!currentShortcut) return;

        const action = Object.keys(shortcuts).find(act => shortcuts[act] === currentShortcut);

        if (action) {
            e.preventDefault();
            if (action === 'togglePlayPause') {
                playPauseBtn.click();
            } else if (action.startsWith('preset_')) {
                const index = parseInt(action.split('_')[1], 10);
                const presetButtons = „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„Ç®„É™„Ç¢.querySelectorAll('.preset-btn');
                if (presetButtons[index]) {
                    presetButtons[index].click();
                }
            }
        }
    }

    function toggleTimerMode() {
        timerMode = (timerMode === 'countdown') ? 'countup' : 'countdown';
        if (currentProgramState) {
            updateAllTimers(currentProgramState);
        }
    }

    function showCustomPrompt(title) {
        return new Promise((resolve) => {
            „Éó„É≠„É≥„Éó„Éà„Çø„Ç§„Éà„É´.textContent = title;
            „Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ.value = '';
            „Ç´„Çπ„Çø„É†„Éó„É≠„É≥„Éó„Éà„É¢„Éº„ÉÄ„É´.classList.remove('hidden');
            „Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ.focus();
            const onOk = () => { cleanup(); resolve(„Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ.value); };
            const onCancel = () => { cleanup(); resolve(null); };
            const onKeyDown = (e) => {
                if (e.key === 'Enter') onOk();
                if (e.key === 'Escape') onCancel();
            };
            „Éó„É≠„É≥„Éó„ÉàOK„Éú„Çø„É≥.onclick = onOk;
            „Éó„É≠„É≥„Éó„Éà„Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥.onclick = onCancel;
            „Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ.addEventListener('keydown', onKeyDown);
            function cleanup() {
                „Éó„É≠„É≥„Éó„ÉàOK„Éú„Çø„É≥.onclick = null;
                „Éó„É≠„É≥„Éó„Éà„Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥.onclick = null;
                „Éó„É≠„É≥„Éó„ÉàÂÖ•ÂäõÊ¨Ñ.removeEventListener('keydown', onKeyDown);
                „Ç´„Çπ„Çø„É†„Éó„É≠„É≥„Éó„Éà„É¢„Éº„ÉÄ„É´.classList.add('hidden');
            }
        });
    }

    function getTemplates() { return JSON.parse(localStorage.getItem('timeqCueTemplates') || '{}'); }
    function saveTemplates(templates) { localStorage.setItem('timeqCueTemplates', JSON.stringify(templates)); }
    function „ÉÜ„É≥„Éó„É¨„Éº„Éà„É™„Çπ„Éà„ÇíÊõ¥Êñ∞() {
        const templates = getTemplates();
        const t = translations[currentLang];
        „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû.innerHTML = `<option value="">${t.selectTemplate}</option>`;
        for (const name in templates) {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû.appendChild(option);
        }
    }

    // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö ---
    Ë®ÄË™ûÈÅ∏Êäû.addEventListener('change', (e) => setLanguage(e.target.value));
    Ë°®Á§∫„Çµ„Ç§„Ç∫ÈÅ∏Êäû.addEventListener('change', (e) => {
        const newScale = e.target.value;
        localStorage.setItem('timeqDisplayScale', newScale);
        applyDisplayScale(newScale);
        setTimeout(handleCanvasResize, 100);
    });
    window.onresize = () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(handleCanvasResize, 250);
    };
    document.addEventListener('fullscreenchange', () => {
        setTimeout(handleCanvasResize, 250);
    });
    „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥.onclick = async () => {
        „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥.disabled = true;
        „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥.textContent = translations[currentLang].serverStarting;
        const result = await window.electronAPI.startServer();
        if (result.error) {
            alert(`${translations[currentLang].alert_connectionFailed}: ${result.error}`);
            „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥.disabled = false;
            „Çµ„Éº„Éê„ÉºËµ∑Âãï„Éú„Çø„É≥.innerHTML = `<i class="fas fa-server"></i> <span data-i18n-key="startAsServer">${translations[currentLang].startAsServer}</span>`;
            return;
        }
        „Çµ„Éº„Éê„ÉºURL„ÉÜ„Ç≠„Çπ„Éà.textContent = result.url;
        „Çµ„Éº„Éê„ÉºQR„Ç≥„Éº„ÉâÁîªÂÉè.src = result.qr;
        „Çµ„Éº„Éê„ÉºÊÉÖÂ†±.classList.remove('hidden');
        electron„Éõ„Éº„É†.classList.add('hidden');
    };
    openDirectorWindowBtn.onclick = () => {
        window.electronAPI.openDirectorWindow();
    };
    openPersonalityWindowBtn.onclick = () => {
        window.electronAPI.openPersonalityWindow();
    };
    „ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å®„Åó„Å¶ÂèÇÂä†„Éú„Çø„É≥.onclick = () => {
        electron„Éõ„Éº„É†.classList.add('hidden');
        browser„Éõ„Éº„É†.classList.remove('hidden');
    };
    directorÂèÇÂä†„Éú„Çø„É≥.onclick = () => ÂèÇÂä†„Åô„Çã('director');
    personalityÂèÇÂä†„Éú„Çø„É≥.onclick = () => ÂèÇÂä†„Åô„Çã('personality');
    Áï™ÁµÑÈñãÂßã„Éú„Çø„É≥.onclick = Áï™ÁµÑ„ÇíÈñãÂßã„Åô„Çã;
    Êõ¥Êñ∞Â±•Ê≠¥„Éú„Çø„É≥.onclick = () => {
        const t = translations[currentLang];
        Êõ¥Êñ∞Â±•Ê≠¥„É™„Çπ„Éà.innerHTML = '';
        t.updateHistoryContent.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${item.version}</strong> ${item.note}`;
            Êõ¥Êñ∞Â±•Ê≠¥„É™„Çπ„Éà.appendChild(li);
        });
        Êõ¥Êñ∞Â±•Ê≠¥„É¢„Éº„ÉÄ„É´.classList.remove('hidden');
    };
    „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„Éú„Çø„É≥.onclick = openShortcutSettingsModal;
    „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà‰øùÂ≠ò„Éú„Çø„É≥.onclick = saveShortcuts;
    Ë°åËøΩÂä†„Éú„Çø„É≥.onclick = () => addCueRow();
    playPauseBtn.onclick = () => sendData('togglePlayPause');
    Ê¨°„Å∏„Éú„Çø„É≥.onclick = () => sendData('nextItem');
    Ââç„Å∏„Éú„Çø„É≥.onclick = () => sendData('prevItem');
    „Ç≠„É£„É≥„Éê„ÇπÊ∂àÂéª„Éú„Çø„É≥.onclick = () => {
        if (ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ) {
            ÊâãÊõ∏„Åç„Éë„ÉÉ„Éâ.clear();
            ÊâãÊõ∏„ÅçÊõ¥Êñ∞Âá¶ÁêÜ();
        }
    };
    „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„Éú„Çø„É≥.onclick = () => {
        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•ÂäõÊ¨Ñ.value = „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà.join(',');
        „Éó„É™„Çª„ÉÉ„ÉàË®≠ÂÆö„É¢„Éº„ÉÄ„É´.classList.remove('hidden');
    };
    „Éó„É™„Çª„ÉÉ„Éà‰øùÂ≠ò„Éú„Çø„É≥.onclick = „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Çí‰øùÂ≠ò„Åô„Çã;
    „Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„Ç®„É™„Ç¢.addEventListener('click', (e) => {
        if (e.target.classList.contains('preset-btn')) {
            const message = e.target.dataset.message;
            sendData('presetMessage', { text: message });
        }
    });
    ‰∫ÜËß£„Éú„Çø„É≥.onclick = () => { sendData('acknowledgement'); };
    „ÉÜ„É≥„Éó„É¨„Éº„Éà‰øùÂ≠ò„Éú„Çø„É≥.onclick = async () => {
        const t = translations[currentLang];
        const name = await showCustomPrompt(t.prompt_enterTemplateName);
        if (!name) return;
        const templates = getTemplates();
        const rows = document.querySelectorAll('#cue-sheet-rows-container .cue-sheet-row');
        const templateData = Array.from(rows).map(row => ({
            title: row.querySelector('.cue-title-input').value,
            minutes: row.querySelector('.cue-minutes-input').value,
            seconds: row.querySelector('.cue-seconds-input').value,
            type: row.querySelector('.cue-type-select').value
        }));
        templates[name] = templateData;
        saveTemplates(templates);
        „ÉÜ„É≥„Éó„É¨„Éº„Éà„É™„Çπ„Éà„ÇíÊõ¥Êñ∞();
        alert(t.alert_templateSaved(name));
    };
    „ÉÜ„É≥„Éó„É¨„Éº„ÉàË™≠Ëæº„Éú„Çø„É≥.onclick = () => {
        const name = „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû.value;
        if (!name) return;
        const templates = getTemplates();
        const templateData = templates[name];
        if (templateData) {
            ÈÄ≤Ë°åË°®Ë°å„Ç≥„É≥„ÉÜ„Éä.innerHTML = '';
            templateData.forEach(item => addCueRow(item.title, item.minutes, item.seconds, item.type));
        }
    };
    „ÉÜ„É≥„Éó„É¨„Éº„ÉàÂâäÈô§„Éú„Çø„É≥.onclick = () => {
        const name = „ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû.value;
        if (!name) return;
        const t = translations[currentLang];
        if (confirm(t.alert_confirmDeleteTemplate(name))) {
            const templates = getTemplates();
            delete templates[name];
            saveTemplates(templates);
            „ÉÜ„É≥„Éó„É¨„Éº„Éà„É™„Çπ„Éà„ÇíÊõ¥Êñ∞();
        }
    };
    „Çø„Ç§„Éû„ÉºË°®Á§∫„Ç®„É™„Ç¢.onclick = toggleTimerMode;
    „Çø„Ç§„Éû„ÉºË°®Á§∫„Ç®„É™„Ç¢_„Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£.onclick = toggleTimerMode;
    Áï™ÁµÑÁµÇ‰∫Ü„Éú„Çø„É≥.onclick = () => {
        if (confirm(translations[currentLang].alert_confirmEndProgram)) {
            sendData('endProgram');
        }
    };
    „É≠„Ç∞„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥.onclick = () => {
        const t = translations[currentLang];
        if (programLog.length === 0) {
            alert(t.alert_noLogToDownload);
            return;
        }
        let totalElapsedMs = 0;
        if (currentProgramState) {
            totalElapsedMs = currentProgramState.totalElapsedTime;
            if (currentProgramState.programStatus === 'running') {
                totalElapsedMs += Date.now() - currentProgramState.lastStartTime;
            }
        }
        const finalLog = [...programLog, `${formatLogTime(totalElapsedMs)} - Log downloaded`];
        const logContent = finalLog.join('\r\n');
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const safeTitle = (currentProgramState?.title || 'program').replace(/[^a-z0-9]/gi, '_').toLowerCase();
        a.download = `log_${safeTitle}_${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };
    „ÉÜ„Éº„ÉûÂàáÊõø„Éú„Çø„É≥.onclick = () => {
        document.body.classList.toggle('dark-theme');
        if (document.body.classList.contains('dark-theme')) {
            localStorage.setItem('theme', 'dark');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.remove('fa-moon');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.add('fa-sun');
        } else {
            localStorage.setItem('theme', 'light');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.remove('fa-sun');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.add('fa-moon');
        }
    };
    copyUrlBtn.onclick = () => {
        const urlToCopy = „Çµ„Éº„Éê„ÉºURL„ÉÜ„Ç≠„Çπ„Éà.textContent;
        if (!urlToCopy || copyUrlBtn.disabled) return;

        navigator.clipboard.writeText(urlToCopy).then(() => {
            const t = translations[currentLang];
            const originalIcon = '<i class="fas fa-copy"></i>';
            copyUrlBtn.innerHTML = `<i class="fas fa-check"></i> ${t.copied}`;
            copyUrlBtn.disabled = true;

            setTimeout(() => {
                copyUrlBtn.innerHTML = originalIcon;
                copyUrlBtn.disabled = false;
            }, 2000);
        }).catch(err => {
            console.error('URL„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ', err);
        });
    };
    Èñâ„Åò„Çã„Éú„Çø„É≥Áæ§.forEach(btn => btn.onclick = () => btn.closest('.modal').classList.add('hidden'));
    window.onclick = (e) => { if (e.target.classList.contains('modal')) e.target.classList.add('hidden'); };
    if (ÂÖ®ÁîªÈù¢Ë°®Á§∫„Éú„Çø„É≥) {
        ÂÖ®ÁîªÈù¢Ë°®Á§∫„Éú„Çø„É≥.onclick = () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Fullscreen failed: ${err.message}`);
                });
            }
        };
    }

    // --- ÂàùÊúüÂåñ ---
    function ÂàùÊúüÂåñ() {
        setLanguage(localStorage.getItem('timeqLang') || 'ja');

        „Éó„É™„Çª„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„ÇÄ();
        „ÉÜ„É≥„Éó„É¨„Éº„Éà„É™„Çπ„Éà„ÇíÊõ¥Êñ∞();
        loadShortcuts();
        loadDisplayScale();
        window.addEventListener('keydown', handleGlobalKeyDown);

        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-theme');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.remove('fa-moon');
            „ÉÜ„Éº„Éû„Ç¢„Ç§„Ç≥„É≥.classList.add('fa-sun');
        }

        const urlParams = new URLSearchParams(window.location.search);
        const role = urlParams.get('role');
        const ip = urlParams.get('ip');

        if (role) {
            IPÂÖ•ÂäõÊ¨Ñ.value = ip;
            if (role === 'director') {
                ÂèÇÂä†„Åô„Çã('director'); // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„ÅÆ‰ª£„Çè„Çä„Å´Áõ¥Êé•Èñ¢Êï∞„ÇíÂëº„Å∂
            } else if (role === 'personality') {
                ÂèÇÂä†„Åô„Çã('personality'); // ‚òÖ‚òÖ‚òÖ „Åì„Å°„Çâ„ÇÇÁõ¥Êé•Èñ¢Êï∞„ÇíÂëº„Å∂„Çà„ÅÜ„Å´Â§âÊõ¥ ‚òÖ‚òÖ‚òÖ
            }
        } else {
            ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã(„Éõ„Éº„É†ÁîªÈù¢);
            if (isElectron) {
                electron„Éõ„Éº„É†.classList.remove('hidden');
            } else {
                browser„Éõ„Éº„É†.classList.remove('hidden');
                const urlParamsFromBrowser = new URLSearchParams(window.location.search);
                const directorIP = urlParamsFromBrowser.get('directorIP');
                if (directorIP) {
                    IPÂÖ•ÂäõÊ¨Ñ.value = directorIP;
                }
            }
        }
    }

    ÂàùÊúüÂåñ();
});