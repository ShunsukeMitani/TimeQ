<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Q (Offline App)</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-broadcast-tower"></i> Time Q</h1>
            <div id="room-info-display" class="hidden">
                IP: <strong id="room-id-text"></strong>
            </div>
            <button id="history-log-btn">更新履歴</button>
        </header>

        <main>
            <div id="home-screen">
                <h2>役割を選択してください</h2>
                <div class="button-group">
                    <button id="create-room-btn"><i class="fas fa-user-tie"></i> 部屋を作る (ディレクター)</button>
                </div>
                <div class="join-room-container">
                    <input type="text" id="room-id-input" placeholder="ディレクターのIPアドレスを入力">
                    <button id="join-room-btn"><i class="fas fa-microphone-alt"></i> 部屋に入る (パーソナリティ)</button>
                </div>
            </div>

            <div id="director-screen" class="hidden">
                <div class="main-layout">
                    <div class="left-panel">
                        <h2><i class="fas fa-list-ol"></i> 進行表 (キューシート)</h2>
                        <div id="director-cue-sheet" class="cue-sheet-area"></div>
                        <div class="cue-sheet-controls">
                            <button id="prev-item-btn"><i class="fas fa-arrow-left"></i> 前へ</button>
                            <button id="next-item-btn">次へ <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    <div class="right-panel">
                        <div id="ack-indicator"><i class="fas fa-check"></i> 了解</div>
                        <div id="timer-display" class="timer-display-area">
                            <div class="timer-label" id="program-timer-label">番組残り時間</div>
                            <div id="program-timer" class="timer-clock">--:--:--</div>
                            <div class="segment-timer-area">
                                <div class="timer-label" id="segment-timer-label">コーナー残り時間</div>
                                <div id="segment-timer" class="segment-timer-clock">--:--</div>
                            </div>
                            <div class="time-diff-area">
                                <div class="timer-label">押し(+)/巻き(-)</div>
                                <div id="time-diff" class="time-diff-clock">+00:00</div>
                            </div>
                        </div>
                        <div class="main-controls">
                            <button id="play-pause-btn"><i class="fas fa-play"></i> START</button>
                        </div>
                        <h2><i class="fas fa-pencil-alt"></i> 手書き指示</h2>
                        <div id="handwriting-wrapper">
                            <canvas id="handwriting-canvas"></canvas>
                        </div>
                        <div id="canvas-controls">
                            <button id="clear-canvas-btn"><i class="fas fa-eraser"></i> 全消し</button>
                        </div>
                        <div class="sub-heading-with-button">
                            <h2><i class="fas fa-paper-plane"></i> プリセットメッセージ</h2>
                            <button id="open-preset-settings-btn" class="icon-btn"><i class="fas fa-cog"></i>
                                設定</button>
                        </div>
                        <div id="preset-buttons-area"></div>
                    </div>
                </div>
                <div class="director-footer-controls">
                    <button id="download-log-btn" class="icon-btn"><i class="fas fa-download"></i> ログをダウンロード</button>
                    <button id="end-program-btn" class="danger-btn"><i class="fas fa-stop-circle"></i> 番組を終了</button>
                </div>
            </div>

            <div id="personality-screen" class="hidden">
                <div class="main-layout">
                    <div class="left-panel">
                        <h2><i class="fas fa-list-ol"></i> 進行表</h2>
                        <div id="personality-cue-sheet" class="cue-sheet-area"></div>
                    </div>
                    <div class="right-panel">
                        <div id="timer-display-personality" class="timer-display-area">
                            <div class="timer-label" id="program-timer-label-personality">番組残り時間</div>
                            <div id="program-timer-personality" class="timer-clock">--:--:--</div>
                            <div class="segment-timer-area">
                                <div class="timer-label" id="segment-timer-label-personality">コーナー残り時間</div>
                                <div id="segment-timer-personality" class="segment-timer-clock">--:--</div>
                            </div>
                            <div class="time-diff-area">
                                <div class="timer-label">押し(+)/巻き(-)</div>
                                <div id="time-diff-personality" class="time-diff-clock">+00:00</div>
                            </div>
                        </div>
                        <h2><i class="fas fa-file-alt"></i> ディレクターからの指示</h2>
                        <div id="instruction-display-area">
                            <p>指示を待っています...</p>
                        </div>
                        <div class="ack-button-area">
                            <button id="ack-btn"><i class="fas fa-check-circle"></i> 了解</button>
                        </div>
                    </div>
                </div>
                <div id="preset-message-display" class="hidden"></div>
            </div>
        </main>
    </div>

    <div id="program-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>番組設定</h2>
            <div id="connection-area">
                <p>パーソナリティを接続</p>
                <div class="qr-code-container">
                    <img id="qr-code-image" src="" alt="接続用QRコード">
                    <span>または、同じWi-Fiに接続し、ブラウザで以下のURLにアクセスしてください:</span>
                    <strong id="connection-url-text"></strong>
                </div>
            </div>
            <label for="program-title">番組タイトル:</label>
            <input type="text" id="program-title" value="マイラジオプログラム">
            <label for="program-duration">番組時間 (分):</label>
            <input type="number" id="program-duration" value="30">
            <label>進行表:</label>
            <div id="cue-sheet-builder">
                <div class="cue-sheet-header">
                    <div class="col-title">内容</div>
                    <div class="col-min">分</div>
                    <div class="col-sec">秒</div>
                    <div class="col-type">タイプ</div>
                    <div class="col-action"></div>
                </div>
                <div id="cue-sheet-rows-container"></div>
                <button id="add-cue-row-btn" class="icon-btn"><i class="fas fa-plus"></i> 行を追加</button>
            </div>
            <div class="template-controls">
                <button id="save-template-btn" class="icon-btn"><i class="fas fa-save"></i> テンプレートとして保存</button>
            </div>
            <div class="template-management">
                <select id="template-select">
                    <option value="">テンプレートを読込</option>
                </select>
                <button id="load-template-btn" class="icon-btn">読込</button>
                <button id="delete-template-btn" class="icon-btn danger-btn"><i class="fas fa-trash"></i></button>
            </div>
            <button id="start-program-btn">この内容で番組を開始</button>
        </div>
    </div>

    <div id="history-log-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>更新履歴</h2>
            <ul id="history-log-list"></ul>
        </div>
    </div>

    <div id="preset-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>プリセットメッセージ設定</h2>
            <p>メッセージをカンマ（,）区切りで入力してください。</p>
            <textarea id="preset-messages-input" rows="5"></textarea>
            <button id="save-preset-messages-btn">設定を保存</button>
        </div>
    </div>

    <div id="custom-prompt-modal" class="modal hidden">
        <div class="prompt-content">
            <h3 id="prompt-title">テンプレート名を入力</h3>
            <input type="text" id="prompt-input">
            <div class="prompt-buttons">
                <button id="prompt-cancel-btn">キャンセル</button>
                <button id="prompt-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <script src="signature_pad.js"></script>
    <script src="script.js"></script>
</body>

</html>