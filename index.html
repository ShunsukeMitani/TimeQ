<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <title>Time Q (Offline App)</title>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <main class="container">
        <header>
            <h1><i class="fas fa-stopwatch"></i>Time Q</h1>
            <div id="header-controls">
                <div id="display-scale-control">
                    <i class="fas fa-desktop"></i>
                    <select id="display-scale-select" data-i18n-title-key="changeDisplaySize">
                        <option value="1" data-i18n-key="display100">表示: 100%</option>
                        <option value="0.9" data-i18n-key="display90">表示: 90%</option>
                        <option value="0.85" data-i18n-key="display85">表示: 85%</option>
                        <option value="0.75" data-i18n-key="display75">表示: 75%</option>
                        <option value="0.5" data-i18n-key="display50">表示: 50% (iPad推奨)</option>
                        <option value="0.3" data-i18n-key="display30">表示: 30%</option>
                    </select>
                </div>
                <div id="language-control">
                    <i class="fas fa-globe"></i>
                    <select id="language-select">
                        <option value="ja">日本語</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <button id="shortcut-settings-btn" class="icon-btn"><i class="fas fa-keyboard"></i><span
                        data-i18n-key="shortcuts">ショートカット</span></button>
                <button id="history-log-btn" class="icon-btn"><i class="fas fa-history"></i><span
                        data-i18n-key="updateHistory">更新履歴</span></button>
                <button id="theme-toggle-btn" class="icon-btn"><i class="fas fa-moon"></i></button>
            </div>
        </header>

        <div id="home-screen">
            <h2 id="home-title" data-i18n-key="role_select">役割を選択してください</h2>
            <div id="electron-home">
                <div class="button-group">
                    <button id="start-server-btn"><i class="fas fa-server"></i> <span
                            data-i18n-key="startAsServer">サーバーとして起動</span></button>
                    <button id="join-as-client-btn"><i class="fas fa-sign-in-alt"></i> <span
                            data-i18n-key="joinAsClient">クライアントとして参加</span></button>
                </div>
            </div>
            <div id="server-info" class="hidden">
                <div id="connection-area">
                    <h2 data-i18n-key="waitingForClientsTitle">クライアントの接続を待っています</h2>
                    <div class="room-id-area" style="margin-bottom: 1rem;">
                        <h3 data-i18n-key="roomIdLabel" style="margin: 0;">ルームID</h3>
                        <p id="room-id-display"
                            style="font-size: 2.5rem; font-weight: bold; color: #2c3e50; margin: 0.5rem 0; letter-spacing: 0.1em;">
                        </p>
                    </div>
                    <p data-i18n-key="waitingForClientsDesc">他のPCやタブレットから、以下のQRコードまたはURLで接続してください。</p>
                    <div class="qr-code-container">
                        <img id="server-qr-code-image" src="" alt="QR Code">
                    </div>
                    <div class="url-container">
                        <p id="server-url-text"></p>
                        <button id="copy-url-btn" class="icon-btn" data-i18n-title-key="copyURL">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="local-open-buttons">
                        <button id="open-director-window-btn">
                            <i class="fas fa-user-tie"></i> <span data-i18n-key="openDirectorWindow">ディレクター画面を開く</span>
                        </button>
                        <button id="open-personality-window-btn">
                            <i class="fas fa-user"></i> <span data-i18n-key="openPersonalityWindow">パーソナリティ画面を開く</span>
                        </button>
                    </div>
                </div>
            </div>
            <div id="browser-home" class="hidden">
                <div class="join-room-container">
                    <input type="number" id="room-id-input" placeholder="4桁のルームIDを入力"
                        data-i18n-placeholder-key="enterRoomId" pattern="\d{4}" maxlength="4"
                        style="text-align: center; font-size: 1.5rem; letter-spacing: 0.2em;">
                    <button id="join-director-btn"><i class="fas fa-user-tie"></i> <span
                            data-i18n-key="joinAsDirector">ディレクターとして参加</span></button>
                    <button id="join-personality-btn"><i class="fas fa-user"></i> <span
                            data-i18n-key="joinAsPersonality">パーソナリティとして参加</span></button>
                </div>
            </div>
        </div>

        <div id="director-screen" class="main-layout hidden">
            <div class="left-panel">
                <div class="sub-heading-with-button" style="margin-top:0; border-top:0; padding-top:0;">
                    <h2><i class="fas fa-list-ol"></i><span data-i18n-key="cueSheet">進行表</span></h2>
                    <button id="cue-sheet-mode-toggle-btn" class="icon-btn" data-i18n-title-key="toggleCueSheetMode"
                        title="表示切替 (時間/開始時刻)">
                        <i class="fas fa-clock"></i>
                    </button>
                </div>
                <div id="director-cue-sheet" class="cue-sheet-area"></div>
                <div class="cue-sheet-controls">
                    <button id="prev-item-btn"><i class="fas fa-backward"></i> <span
                            data-i18n-key="prev">前へ</span></button>
                    <button id="download-log-btn" class="icon-btn"><i class="fas fa-download"></i> <span
                            data-i18n-key="saveLog">ログ保存</span></button>
                    <button id="next-item-btn"><span data-i18n-key="next">次へ</span> <i
                            class="fas fa-forward"></i></button>
                </div>
            </div>
            <div class="right-panel">
                <div id="personality-message-display" class="message-display-overlay hidden"></div>
                <div id="timer-display" class="timer-display-area">
                    <div>
                        <div id="program-timer-label" class="timer-label" data-i18n-key="programTimeRemaining">番組残り時間
                        </div>
                        <div id="program-timer" class="timer-clock">00:00:00</div>
                    </div>
                    <div class="segment-timer-area">
                        <div id="segment-timer-label" class="timer-label" data-i18n-key="segmentTimeRemaining">コーナー残り時間
                        </div>
                        <div id="segment-timer" class="segment-timer-clock">+00:00</div>
                    </div>
                    <div class="time-diff-area">
                        <div class="timer-label" data-i18n-key="timeDifference">押し/巻き</div>
                        <div id="time-diff" class="time-diff-clock">+00:00</div>
                    </div>
                </div>
                <div class="main-controls">
                    <button id="play-pause-btn"><i class="fas fa-play"></i> START</button>
                    <button id="fullscreen-btn" class="icon-btn" style="width: 100%; margin-top: 5px;"><i
                            class="fas fa-expand"></i> <span data-i18n-key="fullscreen">全画面表示</span></button>
                </div>

                <div class="instruction-mode-toggle">
                    <button id="toggle-handwriting-btn" class="instruction-toggle-btn active"
                        data-i18n-key="handwriting">
                        <i class="fas fa-pencil-alt"></i> <span data-i18n-key="handwriting">手書き指示</span>
                    </button>
                    <button id="toggle-keyboard-btn" class="instruction-toggle-btn"
                        data-i18n-key="keyboardInstructions">
                        <i class="fas fa-keyboard"></i> <span data-i18n-key="keyboardInstructions">キーボード指示</span>
                    </button>
                    <div id="ack-indicator" data-i18n-key="acknowledged">了解！</div>
                </div>

                <div id="handwriting-panel">
                    <div id="handwriting-wrapper">
                        <canvas id="handwriting-canvas"></canvas>
                    </div>
                    <div id="canvas-controls">
                        <button id="clear-canvas-btn" class="icon-btn danger-btn"><i class="fas fa-trash"></i> <span
                                data-i18n-key="clear">消去</span></button>
                    </div>
                </div>

                <div id="keyboard-panel" class="hidden">
                    <div id="keyboard-instruction-area">
                        <textarea id="keyboard-instruction-input" rows="3" placeholder="指示を入力して送信"
                            data-i18n-placeholder-key="enterInstruction"></textarea>
                        <button id="send-instruction-btn" class="icon-btn send-icon-btn" data-i18n-title-key="send"
                            title="送信">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>


                <div class="sub-heading-with-button"
                    style="margin-top: 1.25rem; border-top: 1px solid #eee; padding-top: 1.25rem;">
                    <h2><i class="fas fa-bolt"></i><span data-i18n-key="presetMessages">プリセットメッセージ</span></h2>
                    <button id="open-preset-settings-btn" class="icon-btn"><i class="fas fa-cog"></i> <span
                            data-i18n-key="settings">設定</span></button>
                </div>
                <div id="preset-buttons-area"></div>
                <div class="right-panel-footer">
                    <button id="restart-program-btn"><i class="fas fa-redo"></i> <span
                            data-i18n-key="restartProgram">やり直し</span></button>
                    <button id="end-program-btn" class="danger-btn"><i class="fas fa-stop-circle"></i> <span
                            data-i18n-key="endProgram">番組終了</span></button>
                </div>
            </div>
        </div>

        <div id="personality-screen" class="main-layout hidden">
            <div class="left-panel">
                <div id="timer-display-personality" class="timer-display-area">
                    <div>
                        <div id="program-timer-label-personality" class="timer-label"
                            data-i18n-key="programTimeRemaining">番組残り時間</div>
                        <div id="program-timer-personality" class="timer-clock">00:00:00</div>
                    </div>
                    <div class="segment-timer-area">
                        <div id="segment-timer-label-personality" class="timer-label"
                            data-i18n-key="segmentTimeRemaining">コーナー残り時間</div>
                        <div id="segment-timer-personality" class="segment-timer-clock">+00:00</div>
                    </div>
                    <div class="time-diff-area">
                        <div class="timer-label" data-i18n-key="timeDifference">押し/巻き</div>
                        <div id="time-diff-personality" class="time-diff-clock">+00:00</div>
                    </div>
                </div>
                <div class="sub-heading-with-button" style="margin-top:0; border-top:0; padding-top:0;">
                    <h2><i class="fas fa-list-ol"></i><span data-i18n-key="cueSheet">進行表</span></h2>
                    <button id="cue-sheet-mode-toggle-btn-personality" class="icon-btn"
                        data-i18n-title-key="toggleCueSheetMode" title="表示切替 (時間/開始時刻)">
                        <i class="fas fa-clock"></i>
                    </button>
                </div>
                <div id="personality-cue-sheet" class="cue-sheet-area"></div>
            </div>
            <div class="right-panel">
                <h2><i class="fas fa-info-circle"></i><span data-i18n-key="instructions">指示</span></h2>
                <div id="instruction-display-area">
                    <span data-i18n-key="waitingForInstructions">指示を待っています...</span>
                </div>
                <div class="ack-button-area">
                    <button id="ack-btn"><i class="fas fa-check"></i> <span
                            data-i18n-key="acknowledge">了解</span></button>
                </div>

                <div class="sub-heading-with-button">
                    <h2 data-i18n-key="personalityPresets"><i class="fas fa-bolt"></i>プリセットメッセージ</h2>
                    <button id="open-personality-preset-settings-btn" class="icon-btn"><i class="fas fa-cog"></i>
                        <span data-i18n-key="settings">設定</span></button>
                </div>
                <div id="personality-presets-area"></div>
            </div>
        </div>
    </main>

    <div id="program-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 data-i18n-key="programSettings">番組設定</h2>
            <label for="program-title" data-i18n-key="programTitle">番組タイトル</label>
            <input type="text" id="program-title" value="My Radio Program">

            <label data-i18n-key="programDuration">番組全体の時間</label>
            <div class="duration-input-group">
                <input type="number" id="program-duration" value="30" min="0">
                <span data-i18n-key="minutes" class="input-label">分</span>
                <input type="number" id="program-duration-sec" value="0" min="0" max="59">
                <span data-i18n-key="seconds" class="input-label">秒</span>
            </div>
            <label for="countdown-duration" data-i18n-key="countdownDuration">本番開始カウントダウン（秒）</label>
            <input type="number" id="countdown-duration" value="10" min="0">

            <div id="font-size-settings" style="margin-top: 1.25rem; border-top: 1px solid #eee; padding-top: 1.25rem;">
                <h3 data-i18n-key="fontSizeSettings">表示フォントサイズ設定</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="overlay-font-size" data-i18n-key="overlayFontSizeLabel">指示/カウントダウン</label>
                        <select id="overlay-font-size">
                            <option value="1.5" data-i18n-key="fontSizeSmall">小</option>
                            <option value="2.25" data-i18n-key="fontSizeMedium">中</option>
                            <option value="3" data-i18n-key="fontSizeLarge">大</option>
                            <option value="4" data-i18n-key="fontSizeExtraLarge">特大</option>
                        </select>
                    </div>
                    <div>
                        <label for="indicator-font-size" data-i18n-key="indicatorFontSizeLabel">了解/応答</label>
                        <select id="indicator-font-size">
                            <option value="0.8" data-i18n-key="fontSizeSmall">小</option>
                            <option value="1.25" data-i18n-key="fontSizeMedium">中</option>
                            <option value="1.75" data-i18n-key="fontSizeLarge">大</option>
                            <option value="2.5" data-i18n-key="fontSizeExtraLarge">特大</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="cue-sheet-builder">
                <div class="cue-sheet-builder-header">
                    <h3 data-i18n-key="createCueSheet">進行表の作成</h3>
                    <div class="time-entry-mode-switch">
                        <span data-i18n-key="timeEntryModeIndividual">個別</span>
                        <label class="switch">
                            <input type="checkbox" id="time-entry-mode-toggle">
                            <span class="slider round"></span>
                        </label>
                        <span data-i18n-key="timeEntryModeCumulative">加算</span>
                    </div>
                </div>
                <div class="template-management">
                    <select id="template-select">
                        <option value="" data-i18n-key="selectTemplate">テンプレートを選択</option>
                    </select>
                    <button id="load-template-btn" class="icon-btn" title="選択したテンプレートを読み込みます" disabled><i
                            class="fas fa-folder-open"></i><span data-i18n-key="load">読込</span></button>
                    <button id="overwrite-template-btn" class="icon-btn" title="テンプレートを選択してから使用できます" disabled><i
                            class="fas fa-sync-alt"></i><span data-i18n-key="overwrite">上書き保存</span></button>
                    <button id="save-template-btn" class="icon-btn" title="現在の進行表を新しいテンプレートとして保存します"><i
                            class="fas fa-save"></i><span data-i18n-key="save">保存</span></button>
                    <button id="delete-template-btn" class="icon-btn danger-btn" title="選択したテンプレートを削除します" disabled><i
                            class="fas fa-trash"></i></button>
                    <button id="export-templates-btn" class="icon-btn" data-i18n-title-key="exportTemplatesTitle"><i
                            class="fas fa-file-export"></i><span data-i18n-key="exportTemplates">エクスポート</span></button>
                    <button id="import-templates-btn" class="icon-btn" data-i18n-title-key="importTemplatesTitle"><i
                            class="fas fa-file-import"></i><span data-i18n-key="importTemplates">インポート</span></button>
                    <input type="file" id="import-file-input" class="hidden-file-input" accept=".json,.txt">
                </div>
                <div class="cue-sheet-header">
                    <div class="col-title" data-i18n-key="cornerName">コーナー名</div>
                    <div class="col-time-min" data-i18n-key="minutes">分</div>
                    <div class="col-time-sec" data-i18n-key="seconds">秒</div>
                    <div class="col-type" data-i18n-key="type">タイプ</div>
                    <div class="col-action"></div>
                </div>
                <div id="cue-sheet-rows-container"></div>
                <div class="cue-sheet-footer">
                    <button id="add-cue-row-btn"><i class="fas fa-plus"></i> <span
                            data-i18n-key="addRow">行を追加</span></button>
                    <div id="total-time-display" class="hidden">
                        <strong data-i18n-key="totalTime">合計時間:</strong>
                        <span id="total-time-value">0:00</span>
                    </div>
                </div>
            </div>
            <button id="start-program-btn"><i class="fas fa-rocket"></i> <span
                    data-i18n-key="startProgramWithSettings">この内容で番組を開始</span></button>
        </div>
    </div>

    <div id="history-log-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 data-i18n-key="updateHistory">更新履歴</h2>
            <ul id="history-log-list"></ul>
        </div>
    </div>

    <div id="preset-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 data-i18n-key="presetSettings">プリセットメッセージ設定</h2>
            <p data-i18n-key="presetSettingsDesc">カンマ区切りでメッセージを入力してください。</p>
            <textarea id="preset-messages-input" rows="5"></textarea>
            <button id="save-preset-messages-btn"><i class="fas fa-save"></i> <span
                    data-i18n-key="saveBtn">保存する</span></button>
        </div>
    </div>

    <div id="personality-preset-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 data-i18n-key="personalityPresetSettings">パーソナリティ プリセット設定</h2>
            <p data-i18n-key="presetSettingsDesc">カンマ区切りでメッセージを入力してください。</p>
            <textarea id="personality-preset-messages-input" rows="5"></textarea>
            <button id="save-personality-preset-messages-btn"><i class="fas fa-save"></i> <span
                    data-i18n-key="saveBtn">保存する</span></button>
        </div>
    </div>
    <div id="custom-prompt-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="prompt-title"></h3>
            <input type="text" id="prompt-input">
            <div class="prompt-buttons">
                <button id="prompt-cancel-btn" data-i18n-key="cancel">キャンセル</button>
                <button id="prompt-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <div id="shortcut-settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 data-i18n-key="shortcutSettings">ショートカットキー設定</h2>
            <p data-i18n-key="shortcutSettingsDesc">設定したい項目のボックスをクリックしてから、割り当てたいキーを押してください。</p>
            <div id="shortcut-list-container"></div>
            <button id="save-shortcuts-btn" style="width: 100%; margin-top: 20px;"><i class="fas fa-save"></i>
                <span data-i18n-key="saveSettings">この設定を保存</span></button>
        </div>
    </div>

    <div id="preset-message-display" class="message-display-overlay hidden"></div>

    <div id="main-countdown-overlay" class="message-display-overlay hidden"></div>
    <script src="signature_pad.js"></script>
    <script src="script.js"></script>
</body>

</html>